---
phase: 05-ui-refactoring
plan: 02
type: execute
domain: frontend
---

<objective>
Extract PlayerControls and StationPicker components from App.tsx.

Purpose: Complete the UI refactoring by extracting the bottom controls section and station picker modal. This reduces App.tsx to a pure orchestration layer managing state and coordinating between components.

Output: Two new components (PlayerControls.tsx, StationPicker.tsx) that encapsulate playback controls and station search, with App.tsx reduced to ~300 lines.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STRUCTURE.md
@.planning/phases/05-ui-refactoring/05-01-SUMMARY.md

**Source files to refactor:**
@src/App.tsx
@src/App.css
@src/components/ChannelCard.tsx (created in 05-01)
@src/components/ChannelCarousel.tsx (created in 05-01)

**Established patterns (from 05-01):**
- Components in src/components/
- Props interfaces defined in component files
- Channel type exported from App.tsx
- Default exports for components

**Constraint:** This is a REFACTOR - no new features, no behavior changes. All existing functionality must work identically after extraction.
</context>

<tasks>
<task type="auto">
  <name>Task 1: Extract PlayerControls component</name>
  <files>
    src/components/PlayerControls.tsx (create)
    src/App.tsx (modify)
  </files>
  <action>
Create `src/components/PlayerControls.tsx` with:
- Props interface:
  ```typescript
  interface PlayerControlsProps {
    currentChannel: Channel | undefined;
    currentTrack: string;
    isPlaying: boolean;
    onPlayPause: () => void;
    onOpenStationPicker: () => void;
    visible: boolean;
  }
  ```
- Import Channel type from App.tsx
- Render the controls div containing:
  - track-info section (playlist-name, song-name, artist/genre)
  - playback-controls section (play/pause button with SVG icons)
  - listeners-info section
- Handle onClick on track-info to call onOpenStationPicker
- Handle onClick on play button to call onPlayPause

In App.tsx:
- Import PlayerControls from './components/PlayerControls'
- Replace the controls JSX (lines 418-446) with:
  ```tsx
  <PlayerControls
    currentChannel={currentChannel}
    currentTrack={currentTrack}
    isPlaying={isPlaying}
    onPlayPause={handlePlayPause}
    onOpenStationPicker={() => setShowStationPicker(true)}
    visible={contentVisible}
  />
  ```

Do NOT change any class names, do NOT change any styling, do NOT add new features.
  </action>
  <verify>
    - `npm run build` succeeds without errors
    - `npm run lint` passes
    - File exists: src/components/PlayerControls.tsx
    - App.tsx imports and uses PlayerControls
  </verify>
  <done>
    - PlayerControls.tsx exists with proper TypeScript types
    - Play/pause button works
    - Track info displays correctly
    - Clicking track info opens station picker
    - Listener count displays
    - No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Extract StationPicker component</name>
  <files>
    src/components/StationPicker.tsx (create)
    src/App.tsx (modify)
  </files>
  <action>
Create `src/components/StationPicker.tsx` with:
- Props interface:
  ```typescript
  interface StationPickerProps {
    channels: Channel[];
    selectedIndex: number;
    onSelectChannel: (index: number) => void;
    onClose: () => void;
  }
  ```
- Internal state for search: `const [search, setSearch] = useState('')`
- Move highlightMatch function into this component (or make it a utility)
- Render the station-picker-overlay and station-picker with:
  - Header with search input and close button
  - Filtered station list based on search
  - Each station-item with highlighted matches

In App.tsx:
- Remove stationSearch state and setStationSearch
- Remove highlightMatch function
- Import StationPicker from './components/StationPicker'
- Replace the station picker JSX (lines 358-415) with:
  ```tsx
  {showStationPicker && (
    <StationPicker
      channels={channels}
      selectedIndex={selectedIndex}
      onSelectChannel={(index) => {
        playChannel(index);
        setShowStationPicker(false);
      }}
      onClose={() => setShowStationPicker(false)}
    />
  )}
  ```

Do NOT change any class names, do NOT change any styling, do NOT add new features.
  </action>
  <verify>
    - `npm run build` succeeds without errors
    - `npm run lint` passes
    - File exists: src/components/StationPicker.tsx
    - App.tsx no longer contains stationSearch state or highlightMatch
    - App.tsx uses StationPicker component
  </verify>
  <done>
    - StationPicker.tsx exists with proper TypeScript types
    - Search input filters stations by title, description, genre
    - Selected station is highlighted
    - Clicking station selects it and closes picker
    - Close button works
    - Search highlighting works
    - App.tsx reduced by ~60 lines
    - No regression in station picker behavior
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Extracted PlayerControls and StationPicker components, completing the UI refactoring</what-built>
  <how-to-verify>
    1. Run: `npm run dev` in the Tuner directory
    2. Open: http://localhost:5173
    3. Verify bottom controls show: channel name, track info, genre, play button, listener count
    4. Click play button - verify playback starts/stops
    5. Press spacebar - verify play/pause toggles
    6. Click on track info area - verify station picker opens
    7. Type in search box - verify stations filter by name/description/genre
    8. Verify search matches are highlighted in yellow
    9. Click a station in picker - verify it selects and picker closes
    10. Click X button - verify picker closes
    11. Click outside picker - verify picker closes
  </how-to-verify>
  <resume-signal>Type "approved" if all controls and station picker work correctly, or describe any issues</resume-signal>
</task>
</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] All four component files exist in src/components/
- [ ] App.tsx is reduced to orchestration layer (~300 lines or less)
- [ ] No visual or functional changes to any UI element
- [ ] Phase 5 complete: all extraction goals met
</verification>

<success_criteria>
- PlayerControls.tsx and StationPicker.tsx created in src/components/
- App.tsx reduced from ~370 lines (after 05-01) to ~300 lines
- All functionality preserved (playback, station picker, search, filtering)
- TypeScript compilation succeeds
- Human verification confirms no regression
- Phase 5 (UI Refactoring) complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-ui-refactoring/05-02-SUMMARY.md`:

```markdown
---
phase: 05-ui-refactoring
plan: 02
type: execute
status: complete
---

# Phase 5 Plan 2: Controls Component Extraction

**[One-liner describing what was accomplished]**

## Accomplishments
- [ ] Extracted PlayerControls.tsx component
- [ ] Extracted StationPicker.tsx component
- [ ] App.tsx reduced to ~300 lines orchestration layer

## Files Created
- src/components/PlayerControls.tsx
- src/components/StationPicker.tsx

## Files Modified
- src/App.tsx (removed state, use new components)

## Phase 5 Complete

**Component inventory after refactoring:**
- src/components/ChannelCard.tsx - Individual channel thumbnail
- src/components/ChannelCarousel.tsx - Horizontal scrolling channel list
- src/components/PlayerControls.tsx - Bottom playback controls
- src/components/StationPicker.tsx - Modal station search/selection

**App.tsx now contains:**
- Application state management
- Audio playback logic
- Keyboard navigation
- Data fetching
- Component orchestration

## Next Phase Readiness
Phase 6 (Genre Panel Updates) unblocked - can consume /api/channels endpoint with extracted component architecture.
```
</output>
