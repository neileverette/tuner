---
phase: 05-ui-refactoring
plan: 03
type: execute
domain: frontend
status: ready
---

<objective>
Complete UI component extraction from App.tsx to achieve clean separation of concerns.

Purpose: Decompose the remaining 364-line App.tsx by extracting StationPicker, PlayerControls, HeroArtwork, and SplashScreen into self-contained components. This completes Phase 5 and creates a component architecture ready for Phase 6 (Genre Panel Updates).

Output: Four new components extracted, App.tsx reduced to ~200 lines of pure orchestration (state management, keyboard navigation, audio control).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STRUCTURE.md

**Current codebase state:**
- ChannelCarousel.tsx already extracted (src/components/)
- ChannelCard.tsx already extracted (src/components/)
- App.tsx is 364 lines with inline: StationPicker, PlayerControls, HeroArtwork, SplashScreen, Instructions

**Source files to refactor:**
@src/App.tsx (364 lines)
@src/App.css

**Established patterns:**
- Components in src/components/
- Props interfaces defined in component files
- Channel type imported from src/types
- Default exports for components
- camelCase handlers with handle{Action} prefix
- useCallback for memoized handlers
- No path aliases (relative imports only)

**Constraint:** This is a REFACTOR - no new features, no behavior changes. All existing functionality must work identically after extraction.
</context>

<tasks>
<task type="auto">
  <name>Task 1: Extract StationPicker component</name>
  <files>
    src/components/StationPicker.tsx (create)
    src/App.tsx (modify)
  </files>
  <action>
Create `src/components/StationPicker.tsx` with:

```typescript
import { useState } from 'react'
import type { Channel } from '../types'

interface StationPickerProps {
  channels: Channel[]
  selectedIndex: number
  onSelectChannel: (index: number) => void
  onClose: () => void
}
```

Move into StationPicker:
- Internal state: `const [search, setSearch] = useState('')`
- The `highlightMatch` function (lines 198-205 of App.tsx)
- The entire station-picker-overlay JSX (lines 271-328)
- Filter logic for search matching

StationPicker handles:
- Search input state internally
- Filtering channels by title/description/genre
- Highlighting search matches
- Calling onSelectChannel when station clicked
- Calling onClose when overlay/X clicked

In App.tsx:
- Remove `stationSearch` state and `setStationSearch`
- Remove `highlightMatch` function
- Import StationPicker from './components/StationPicker'
- Replace station picker JSX with:
  ```tsx
  {showStationPicker && (
    <StationPicker
      channels={channels}
      selectedIndex={selectedIndex}
      onSelectChannel={(index) => {
        playChannel(index)
        setShowStationPicker(false)
      }}
      onClose={() => setShowStationPicker(false)}
    />
  )}
  ```

Do NOT change any class names, do NOT change any styling, do NOT add new features.
  </action>
  <verify>
    - `npm run build` succeeds without errors
    - `npm run lint` passes
    - File exists: src/components/StationPicker.tsx
    - App.tsx no longer contains stationSearch state or highlightMatch function
  </verify>
  <done>
    - StationPicker.tsx exists with proper TypeScript types
    - Search input filters stations correctly
    - Search highlighting works
    - Station selection works
    - Close button and overlay click work
    - App.tsx reduced by ~65 lines
  </done>
</task>

<task type="auto">
  <name>Task 2: Extract PlayerControls component</name>
  <files>
    src/components/PlayerControls.tsx (create)
    src/App.tsx (modify)
  </files>
  <action>
Create `src/components/PlayerControls.tsx` with:

```typescript
import type { Channel } from '../types'

interface PlayerControlsProps {
  currentChannel: Channel | undefined
  currentTrack: string
  isPlaying: boolean
  onPlayPause: () => void
  onOpenStationPicker: () => void
  visible: boolean
}
```

Move into PlayerControls:
- The entire controls div JSX (lines 331-359)
- Contains: track-info, playback-controls, listeners-info sections

PlayerControls renders:
- Track info (channel title, current track, genre) with click handler to open picker
- Play/pause button with correct icon based on isPlaying
- Listener count display

In App.tsx:
- Import PlayerControls from './components/PlayerControls'
- Replace controls JSX with:
  ```tsx
  <PlayerControls
    currentChannel={selectedChannel}
    currentTrack={currentTrack}
    isPlaying={isPlaying}
    onPlayPause={handlePlayPause}
    onOpenStationPicker={() => setShowStationPicker(true)}
    visible={contentVisible}
  />
  ```

Do NOT change any class names, do NOT change any styling, do NOT add new features.
  </action>
  <verify>
    - `npm run build` succeeds without errors
    - `npm run lint` passes
    - File exists: src/components/PlayerControls.tsx
    - App.tsx uses PlayerControls component
  </verify>
  <done>
    - PlayerControls.tsx exists with proper TypeScript types
    - Play/pause button toggles correctly
    - Track info displays channel name, track, genre
    - Clicking track info opens station picker
    - Listener count displays
    - App.tsx reduced by ~30 lines
  </done>
</task>

<task type="auto">
  <name>Task 3: Extract HeroArtwork component</name>
  <files>
    src/components/HeroArtwork.tsx (create)
    src/App.tsx (modify)
  </files>
  <action>
Create `src/components/HeroArtwork.tsx` with:

```typescript
interface HeroArtworkProps {
  currentImage: string
  prevImage: string
  isTransitioning: boolean
  transitionDirection: 'left' | 'right'
  altText: string
}
```

Move into HeroArtwork:
- The hero-artwork div JSX (lines 227-242)
- Handles crossfade animation between images

HeroArtwork renders:
- Previous image (when exists) with transition classes
- Current image with transition classes
- CSS classes for transition direction

In App.tsx:
- Import HeroArtwork from './components/HeroArtwork'
- Replace hero-artwork JSX with:
  ```tsx
  <HeroArtwork
    currentImage={currentImage}
    prevImage={prevImage}
    isTransitioning={isTransitioning}
    transitionDirection={transitionDirection}
    altText={selectedChannel?.title || 'Channel art'}
  />
  ```

Do NOT change any class names, do NOT change any styling, do NOT add new features.
  </action>
  <verify>
    - `npm run build` succeeds without errors
    - `npm run lint` passes
    - File exists: src/components/HeroArtwork.tsx
    - App.tsx uses HeroArtwork component
  </verify>
  <done>
    - HeroArtwork.tsx exists with proper TypeScript types
    - Image crossfade works when changing channels
    - Transition direction (left/right) animates correctly
    - App.tsx reduced by ~20 lines
  </done>
</task>

<task type="auto">
  <name>Task 4: Extract SplashScreen component</name>
  <files>
    src/components/SplashScreen.tsx (create)
    src/App.tsx (modify)
  </files>
  <action>
Create `src/components/SplashScreen.tsx` with:

```typescript
interface SplashScreenProps {
  phase: 'visible' | 'fading' | 'hidden'
  backgroundImage: string
}
```

Move into SplashScreen:
- The splash-screen div JSX (lines 218-224)
- Renders logo with blur background and overlay

SplashScreen renders:
- Blur background div with channel image
- Overlay div
- Logo image
- Phase class for animation state

In App.tsx:
- Import SplashScreen from './components/SplashScreen'
- Replace splash-screen JSX with:
  ```tsx
  {showSplash && (
    <SplashScreen
      phase={splashPhase}
      backgroundImage={currentImage}
    />
  )}
  ```

Do NOT change any class names, do NOT change any styling, do NOT add new features.
  </action>
  <verify>
    - `npm run build` succeeds without errors
    - `npm run lint` passes
    - File exists: src/components/SplashScreen.tsx
    - App.tsx uses SplashScreen component
  </verify>
  <done>
    - SplashScreen.tsx exists with proper TypeScript types
    - Splash animation sequence works (visible -> fading -> hidden)
    - Logo displays correctly
    - Background blur effect works
    - App.tsx reduced by ~10 lines
  </done>
</task>

<task type="auto">
  <name>Task 5: Extract Instructions component</name>
  <files>
    src/components/Instructions.tsx (create)
    src/App.tsx (modify)
  </files>
  <action>
Create `src/components/Instructions.tsx` with:

```typescript
interface InstructionsProps {
  visible: boolean
  onDismiss: () => void
}
```

Move into Instructions:
- The instructions-inline div JSX (lines 245-254)
- Renders keyboard hint banner with close button

Instructions renders:
- Instruction text with keyboard shortcuts
- Close button with X icon
- Visibility class based on prop

In App.tsx:
- Remove `dismissInstructions` function (move inline or to component)
- Import Instructions from './components/Instructions'
- Replace instructions JSX with:
  ```tsx
  {showInstructions && (
    <Instructions
      visible={contentVisible}
      onDismiss={() => {
        setShowInstructions(false)
        localStorage.setItem('tuner-instructions-dismissed', 'true')
      }}
    />
  )}
  ```

Do NOT change any class names, do NOT change any styling, do NOT add new features.
  </action>
  <verify>
    - `npm run build` succeeds without errors
    - `npm run lint` passes
    - File exists: src/components/Instructions.tsx
    - App.tsx uses Instructions component
  </verify>
  <done>
    - Instructions.tsx exists with proper TypeScript types
    - Instructions display on first visit
    - Close button dismisses and persists to localStorage
    - Animation visibility works
    - App.tsx reduced by ~15 lines
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Extracted StationPicker, PlayerControls, HeroArtwork, SplashScreen, and Instructions components from App.tsx</what-built>
  <how-to-verify>
    1. Run: `npm run dev` in the Tuner directory
    2. Open: http://localhost:5173
    3. Verify splash screen appears with logo and fades out
    4. Verify hero image shows current channel artwork
    5. Change channels with arrow keys - verify image crossfade animation
    6. Verify instructions banner appears (clear localStorage if needed: localStorage.removeItem('tuner-instructions-dismissed'))
    7. Click X on instructions - verify it dismisses and stays dismissed on reload
    8. Verify bottom controls show channel name, track info, genre, play button, listeners
    9. Click play - verify playback starts
    10. Press spacebar - verify play/pause toggles
    11. Click on track info area - verify station picker opens
    12. Type in search - verify filtering works with highlighting
    13. Click a station - verify selection and picker closes
    14. Click X or outside picker - verify it closes
  </how-to-verify>
  <resume-signal>Type "approved" if all components work correctly, or describe any issues</resume-signal>
</task>
</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] All five new component files exist in src/components/
- [ ] App.tsx is reduced to ~200 lines (from 364)
- [ ] App.tsx contains only: state management, audio refs, keyboard handlers, orchestration
- [ ] No visual or functional changes to any UI element
- [ ] All animations work (splash, hero crossfade, visibility transitions)
</verification>

<success_criteria>
- StationPicker.tsx, PlayerControls.tsx, HeroArtwork.tsx, SplashScreen.tsx, Instructions.tsx created
- App.tsx reduced from 364 lines to ~200 lines
- App.tsx is now a thin orchestration layer:
  - State management (selectedIndex, isPlaying, showStationPicker, etc.)
  - Audio playback logic (audioRef, playChannel, handlePlayPause)
  - Keyboard navigation (useEffect with keydown listener)
  - Data fetching (useChannels, useNowPlaying hooks)
  - Component composition (renders extracted components)
- All functionality preserved with identical behavior
- TypeScript compilation succeeds
- Human verification confirms no regression
- Phase 5 (UI Refactoring) complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-ui-refactoring/05-03-SUMMARY.md`:

```markdown
---
phase: 05-ui-refactoring
plan: 03
type: execute
status: complete
---

# Phase 5 Plan 3: Complete Component Extraction

**Extracted all remaining inline UI from App.tsx into self-contained components.**

## Accomplishments
- [ ] Extracted StationPicker.tsx (search modal with filtering)
- [ ] Extracted PlayerControls.tsx (bottom playback controls)
- [ ] Extracted HeroArtwork.tsx (background image with crossfade)
- [ ] Extracted SplashScreen.tsx (initial loading animation)
- [ ] Extracted Instructions.tsx (keyboard hint banner)
- [ ] App.tsx reduced from 364 lines to ~200 lines

## Files Created
- src/components/StationPicker.tsx
- src/components/PlayerControls.tsx
- src/components/HeroArtwork.tsx
- src/components/SplashScreen.tsx
- src/components/Instructions.tsx

## Files Modified
- src/App.tsx (removed inline JSX, uses new components)

## Component Inventory (Phase 5 Complete)

| Component | Purpose | Lines |
|-----------|---------|-------|
| ChannelCard.tsx | Individual channel thumbnail | ~25 |
| ChannelCarousel.tsx | Horizontal scrolling channel list | ~90 |
| StationPicker.tsx | Modal station search/selection | ~80 |
| PlayerControls.tsx | Bottom playback controls | ~50 |
| HeroArtwork.tsx | Background image with crossfade | ~30 |
| SplashScreen.tsx | Initial loading animation | ~20 |
| Instructions.tsx | Keyboard hint banner | ~25 |

## App.tsx After Refactoring
- State management (~30 lines)
- Audio playback logic (~60 lines)
- Keyboard navigation (~25 lines)
- Effects (splash, track sync) (~25 lines)
- Component composition (~60 lines render)

## Next Phase Readiness
Phase 6 (Genre Panel Updates) unblocked:
- Clean component architecture established
- /api/channels endpoint ready (from Phase 4)
- Can add GenrePanel.tsx following established patterns
```
</output>
